# Project Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Butbul Halacha Ingest System                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   YouTube API    â”‚
â”‚  (Google Cloud)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ API Key
         â”‚ Channel ID
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        YouTubeService                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ get_playlists(filter="×”×œ×›×” ×™×•××™×ª")                      â”‚   â”‚
â”‚  â”‚ â€¢ get_playlist_videos(playlist_id)                         â”‚   â”‚
â”‚  â”‚ â€¢ get_videos_from_filtered_playlists()                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Video metadata (1,123 videos)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Ingestion Pipeline                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Fetch playlists with "×”×œ×›×” ×™×•××™×ª"                     â”‚   â”‚
â”‚  â”‚ 2. Extract all videos from playlists                       â”‚   â”‚
â”‚  â”‚ 3. Attempt database storage (upsert)                       â”‚   â”‚
â”‚  â”‚ 4. Fallback to JSON if DB unavailable                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                       â”‚
     â”‚ Database Available                                    â”‚ Database Unavailable
     â–¼                                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL Database â”‚                        â”‚   videos_backup.json   â”‚
â”‚   (Supabase)         â”‚                        â”‚      (0.71 MB)         â”‚
â”‚                      â”‚                        â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                        â”‚  1,123 videos          â”‚
â”‚  â”‚  videos table  â”‚  â”‚                        â”‚  Ready for import      â”‚
â”‚  â”‚                â”‚  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ â€¢ video_id PK  â”‚  â”‚                                 â”‚
â”‚  â”‚ â€¢ url          â”‚  â”‚                                 â”‚ When DB available
â”‚  â”‚ â€¢ description  â”‚  â”‚                                 â”‚
â”‚  â”‚ â€¢ published_at â”‚  â”‚                                 â–¼
â”‚  â”‚ â€¢ created_at   â”‚  â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ â€¢ updated_at   â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  import_from_json.py   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
Step 1: Collection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

YouTube Channel
  â”‚
  â”œâ”€â”€ Playlist: ×”×œ×›×” ×™×•××™×ª ×ª×©×¤"×• (7 videos)
  â”œâ”€â”€ Playlist: ×”×œ×›×” ×™×•××™×ª ×ª×©×¤"×” (294 videos)
  â”œâ”€â”€ Playlist: ×”×œ×›×” ×™×•××™×ª ×ª×©×¤"×“ (320 videos)
  â”œâ”€â”€ Playlist: ×”×œ×›×” ×™×•××™×ª ×ª×©×¤"×’ (298 videos)
  â””â”€â”€ Playlist: ×”×œ×›×” ×™×•××™×ª ×ª×©×¤"×‘ (199 videos)
           â”‚
           â–¼
    YouTubeService
           â”‚
           â–¼
    [1,123 Videos]
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                  â–¼                  â–¼
      video_id            url            description
      published_at        title          ...
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main.py   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  config.py   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   .env      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                â”‚
       â”‚                                                â”‚
       â”‚ imports                               Database URL
       â”‚                                       YouTube API Key
       â–¼                                       Channel ID
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ingest_videos_v2   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ uses
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                          â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ youtube_serviceâ”‚    â”‚   database.py    â”‚    â”‚  JSON backup     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚                        â”‚
      â”‚                         â”‚                        â”‚
      â–¼                         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YouTube API v3 â”‚    â”‚   PostgreSQL     â”‚    â”‚ videos_backup    â”‚
â”‚ (Google)       â”‚    â”‚   (Supabase)     â”‚    â”‚     .json        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure Tree

```
butbul-halacha-ingest/
â”‚
â”œâ”€â”€ ğŸ“ src/                          # Source code
â”‚   â”œâ”€â”€ ğŸ __init__.py              # Package initialization
â”‚   â”œâ”€â”€ âš™ï¸  config.py                # Configuration from .env
â”‚   â”œâ”€â”€ ğŸ—„ï¸  database.py              # SQLAlchemy models
â”‚   â”œâ”€â”€ ğŸ“¹ youtube_service.py        # YouTube API client
â”‚   â”œâ”€â”€ ğŸš€ main.py                   # Application entry point
â”‚   â”œâ”€â”€ ğŸ“¥ ingest_videos_v2.py       # Main ingestion pipeline
â”‚   â”œâ”€â”€ ğŸ’¾ import_from_json.py       # JSON â†’ Database importer
â”‚   â”œâ”€â”€ ğŸ“Š show_summary.py           # Statistics display
â”‚   â”œâ”€â”€ ğŸ§ª test_youtube.py           # YouTube API test
â”‚   â””â”€â”€ ğŸ§ª test_db.py                # Database test
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # Unit tests
â”‚   â”œâ”€â”€ ğŸ __init__.py
â”‚   â”œâ”€â”€ âœ… test_config.py            # Config tests (3/3 passing)
â”‚   â””â”€â”€ âœ… test_main.py
â”‚
â”œâ”€â”€ ğŸ“ docs/                         # Documentation
â”‚   â”œâ”€â”€ ğŸ“„ CONFIGURATION.md          # Setup guide
â”‚   â””â”€â”€ ğŸ“„ STEP1_INGESTION.md        # Pipeline documentation
â”‚
â”œâ”€â”€ ğŸ“ env/                          # Python virtual environment
â”‚
â”œâ”€â”€ ğŸ”’ .env                          # Environment variables (secret)
â”œâ”€â”€ ğŸ“‹ .env.example                  # Template for .env
â”œâ”€â”€ ğŸš« .gitignore                    # Git ignore rules
â”œâ”€â”€ ğŸ“œ schema.sql                    # Database schema SQL
â”œâ”€â”€ ğŸ“¦ pyproject.toml                # Poetry dependencies
â”œâ”€â”€ ğŸ”’ poetry.lock                   # Locked dependencies
â”œâ”€â”€ ğŸ“– README.md                     # Project overview
â”œâ”€â”€ ğŸ“ QUICK_REFERENCE.md            # Command reference
â”œâ”€â”€ ğŸ“‹ IMPLEMENTATION_SUMMARY.md     # This summary
â””â”€â”€ ğŸ’¾ videos_backup.json            # Collected videos (0.71 MB)
```

## Module Dependencies

```
main.py
  â””â”€â”€ config.py
        â””â”€â”€ python-dotenv
              â””â”€â”€ .env

  â””â”€â”€ ingest_videos_v2.py
        â”œâ”€â”€ config.py
        â”œâ”€â”€ database.py
        â”‚     â”œâ”€â”€ sqlalchemy
        â”‚     â”œâ”€â”€ psycopg2-binary
        â”‚     â””â”€â”€ config.py
        â””â”€â”€ youtube_service.py
              â”œâ”€â”€ google-api-python-client
              â””â”€â”€ config.py
```

## Execution Flow

```
1. User runs: poetry run python src/main.py
                      â”‚
                      â–¼
2. main.py loads config from .env
                      â”‚
                      â–¼
3. Calls ingest_videos("×”×œ×›×” ×™×•××™×ª")
                      â”‚
                      â–¼
4. YouTubeService connects to API
                      â”‚
                      â–¼
5. Fetches playlists matching filter
                      â”‚
                      â–¼
6. For each playlist: fetch all videos
                      â”‚
                      â–¼
7. Try database connection
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                         â–¼
    SUCCESS                    FAILURE
         â”‚                         â”‚
         â–¼                         â–¼
8a. Upsert to DB            8b. Save to JSON
         â”‚                         â”‚
         â–¼                         â–¼
9a. Show DB summary         9b. Show JSON path
                                  â”‚
                                  â–¼
                           9c. Show import command
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer              â”‚
â”‚  â€¢ Python 3.12+                         â”‚
â”‚  â€¢ Poetry (dependency management)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Framework Layer                â”‚
â”‚  â€¢ SQLAlchemy 2.0 (ORM)                 â”‚
â”‚  â€¢ Google API Client (YouTube)          â”‚
â”‚  â€¢ python-dotenv (config)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Infrastructure Layer           â”‚
â”‚  â€¢ PostgreSQL (Supabase)                â”‚
â”‚  â€¢ YouTube Data API v3                  â”‚
â”‚  â€¢ JSON (fallback storage)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
Try: Connect to Database
  â”‚
  â”œâ”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                        â”‚
  â”‚  Try: Upsert videos                   â”‚
  â”‚    â”‚                                   â”‚
  â”‚    â”œâ”€ Success â”€â”€â–¶ Continue            â”‚
  â”‚    â”‚                                   â”‚
  â”‚    â””â”€ Error â”€â”€â”€â–¶ Log error            â”‚
  â”‚                  Rollback              â”‚
  â”‚                  Continue with next    â”‚
  â”‚                                        â”‚
  â””â”€ Database connection failure           â”‚
       â”‚                                   â”‚
       â””â”€â”€â–¶ Fallback to JSON               â”‚
              â”‚                            â”‚
              â””â”€â”€â–¶ Save all videos         â”‚
                   Generate import cmd     â”‚
                                           â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â””â”€â”€â–¶ Display summary statistics
       Exit gracefully
```

This architecture ensures:
- âœ… Modularity: Each component has single responsibility
- âœ… Testability: Components can be tested independently  
- âœ… Resilience: Fallback mechanisms prevent data loss
- âœ… Maintainability: Clear separation of concerns
- âœ… Scalability: Easy to add new pipeline steps
